@startuml ER Diagram for GoSnack

title "GoSnack - ER Diagram"

' Configuração
hide circle
skinparam linetype ortho

' Usuário
entity "users" as user {
    id: UUID PRIMARY KEY
    --
    first_name: TEXT NOT NULL
    last_name: TEXT NOT NULL
    role: user_role NOT NULL DEFAULT 'customer'
    is_active: BOOLEAN DEFAULT true
    updated_at: TIMESTAMP DEFAULT now()
}
note left
    ENUM user_role {customer, employee, manager, admin}
end note

' Unidades
entity "units" as unit {
    id: UUID PRIMARY KEY
    --
    name: TEXT NOT NULL UNIQUE
    is_active: BOOLEAN DEFAULT true
    created_at: TIMESTAMP DEFAULT now()
    updated_at: TIMESTAMP DEFAULT now()
}

' Relação entre Unidades e Administradores
entity "unit_admin" as unit_admin {
    unit_id: UUID NOT NULL PRIMARY KEY
    admin_id: UUID NOT NULL PRIMARY KEY
}
unit ||--o{ unit_admin : has
user ||--o{ unit_admin : manages

' Lanchonetes
entity "cafeteria" as cafeteria {
    id: UUID PRIMARY KEY
    --
    name: TEXT NOT NULL UNIQUE
    location: TEXT
    is_active: BOOLEAN DEFAULT true
    created_at: TIMESTAMP DEFAULT now()
    updated_at: TIMESTAMP DEFAULT now()
}
unit ||--o{ cafeteria : in

' Lanchonetes e Funcionários/Gerentes
entity cafeteria_staff_profile {
    user_id: UUID NOT NULL PRIMARY KEY
    cafeteria_id: UUID NOT NULL PRIMARY KEY
    --
    hire_date: DATE NOT NULL
}
cafeteria ||--o{ cafeteria_staff_profile : employs
user ||--o{ cafeteria_staff_profile : works_as


' Horários de Funcionamento de Lanchonetes
entity "cafeteria_opening_hours" as cafeteria_opening_hours {
    id: UUID PRIMARY KEY
    cafeteria_id: UUID NOT NULL
    --
    period: day_period NOT NULL
}
note left
    ENUM day_period {weekday, saturday}
end note
cafeteria ||--o{ cafeteria_opening_hours

' Telefones das lanchonetes
entity "cafeteria_phone" as cafeteria_phone {
    id: UUID PRIMARY KEY
    cafeteria_id: UUID NOT NULL
    --
    phone_number: TEXT NOT NULL
    is_whatsapp: BOOLEAN DEFAULT false
}
cafeteria ||--o{ cafeteria_phone : has

' Categorias de Produtos
entity "category" as category {
    id: UUID PRIMARY KEY
    --
    name: TEXT NOT NULL UNIQUE
    icon: TEXT
}

' Produtos
entity "product" as product {
    id: UUID PRIMARY KEY
    cafeteria_id: UUID NOT NULL
    category_id: UUID NOT NULL
    --
    name: TEXT NOT NULL
    description: TEXT
    price: DECIMAL(10, 2) NOT NULL
    discount: INTEGER DEFAULT 0
    stock: INTEGER DEFAULT 0
    is_active: BOOLEAN DEFAULT true
    created_at: TIMESTAMP DEFAULT now()
    updated_at: TIMESTAMP DEFAULT now()
}
cafeteria ||--o{ product : offers
category ||--o{ product : categorizes

' Pedidos
entity order {
    id: UUID PRIMARY KEY
    customer_id: UUID NOT NULL
    cafeteria_id: UUID NOT NULL
    employee_id: UUID
    --
    status: order_status NOT NULL DEFAULT 'pending'
}
note right
    ENUM order_status {pending, preparing, ready, completed, cancelled}
end note
user ||--o{ order : places
cafeteria ||--o{ order : receives
user ||--o{ order : handles

' Item de pedido
entity order_item {
    id: UUID PRIMARY KEY
    order_id: UUID NOT NULL
    product_id: UUID NOT NULL
    --
    quantity: INTEGER NOT NULL
    price_at_order: DECIMAL(10, 2) NOT NULL
    notes: TEXT
}
order ||--o{ order_item : contains
product ||--o{ order_item : included_in

@enduml